# ユーザーマニュアル

## 概要

React DB Plugin は WordPress 上でカスタムデータベーステーブルや CSV データを管理できるプラグインです。React 製のインターフェースから CSV のインポート／エクスポート、テーブル編集、操作ログ閲覧、データ出力設定などが行えます。保存したデータは REST API やショートコードを介して取得・表示することも可能です。

## インストール

1. **JavaScript 依存パッケージのインストール**
   ```bash
   npm install
   ```
2. **React アプリケーションのビルド**
   ```bash
   npm run build
   ```
   ビルド後は `scripts/copy-build.js` により生成物が `react-db-plugin/assets` に `app.js` と `app.css` としてコピーされます。
3. **WordPress への配置**
   `react-db-plugin` ディレクトリを WordPress の `wp-content/plugins` に移動し、管理画面から **React DB Plugin** を有効化します。有効化すると `/react-db-app/` ページが作成され、React インターフェースが読み込まれます。操作ログ用の `wp_reactdb_logs` テーブルも自動で作成されます。

## インターフェースへのアクセス

* **管理画面メニュー** – プラグインを有効化すると WordPress ダッシュボードに「React DB」メニューが表示されます。ここから React アプリを起動できます。
* **フロントエンドページ** – ログインした状態で `/react-db-app/` を開くと、同じインターフェースを管理画面外で利用できます。ページが存在しない場合は新規ページを作成し、`[reactdb_app]` ショートコードを挿入してください。

React UI はヘッダー、サイドバー、複数のツールで構成されています。

- **CSV インポート** – CSV ファイルをアップロードして新しいテーブルを作成します。テーブル名を指定しない場合はファイル名が使用されます。最初の 100 行からカラム型を自動判定します。
- **CSV エクスポート** – 既存のテーブルを選択して CSV 形式でダウンロードできます。
- **DB 登録** – テーブル名とカラム定義、デフォルト値、`created_at`/`updated_at` の自動追加などを設定して新規テーブルを作成します。
- **データベース一覧** – 既存テーブルの閲覧、コピー、削除、行の表示・編集ができます。`logs` など保護されたテーブルは削除できません。
- **操作ログ** – `wp_reactdb_logs` に記録された最近の操作を確認できます。ユーザー ID や説明が保存されています。
- **出力設定** – テーブルデータを JSON または HTML として出力するタスクを定義します。HTML スニペットでは `{{column}}` プレースホルダーを利用でき、`[reactdb_output task="taskName"]` で表示可能です。

## テーブル編集

**データベース一覧** からテーブルを選択すると内容を表示できます。各行には削除や編集ボタンがあり、編集フォームでは値の変更や新規行の追加を行います。自動採番 ID やタイムスタンプ列などの読み取り専用フィールドは変更できません。保存時は `/wp-json/reactdb/v1` REST API へ認証用ノンス付きでリクエストが送信されます。

新しいテーブルを作成する場合は **DB 登録** 画面を開きます。テーブル名とともに INT、VARCHAR(255)、TEXT、DATETIME などのカラムを追加し、必要に応じて `created_at` と `updated_at` フィールドを自動生成できます。

## 出力 API

**出力設定** で登録したタスクは次の方法で取得できます。

- JSON 形式: `https://your-site.com/wp-json/reactdb/v1/output/<task>`
- HTML 形式: `[reactdb_output task="<task>"]`

これらのエンドポイントは対象テーブルの全行を返します。HTML 形式では保存されたスニペットをもとにリストが生成されます。タスクの設定は WordPress オプション `reactdb_output_settings` に保存されています。

## その他のショートコード

- `[reactdb input='DB:"table",data']` – 指定したテーブルの先頭行を表示します。
- `[reactdb_app]` – 前述の React インターフェース全体を任意のページに埋め込むショートコードです（`/react-db-app/` ページでも利用）。

## アンインストール

プラグインを削除すると `wp_reactdb_logs` テーブルと `/react-db-app/` ページは自動的に削除されます。

## プラグイン情報の更新

表示されるバージョンや作者を変更する場合は `react-db-plugin/react-db-plugin.php` を編集してください。React アプリ側のバージョン番号を更新する場合は `package.json` の `"version"` を変更し、再度 `npm run build` を実行して反映させます。

## テスト

必要な依存関係が整っていれば `npm test` でテストを実行できます。この環境では `react-scripts` がインストールされていないため、テストは失敗します。
